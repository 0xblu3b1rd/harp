#!/usr/bin/env node

var path    = require('path')
var program = require('commander')
var pkg     = require('../package.json')
var harp    = require('../')

program
  .version(pkg.version)
  .usage('[project-path] [options]')
  .option('-s, --server [port]', 'start a server for harp app (dynamically generates assets)')
  .option('-c, --compile [output-path]', 'compiles static assets. (relative to project-path)')
  .option('-d, --dirmode [port]', 'hosts a directory of harp apps.')
  .parse(process.argv)

if(program.args.length > 0){
  var projectPath = path.resolve(program.args[0])
}else{
  var cwd         = process.cwd()
  var projectPath = path.resolve(cwd)
}

if(program.server){
  var port = program.server === true
    ? 9966
    : program.server
  harp.server(projectPath, { port: port }, function(){
    console.log("harp is listening on port", port)
  })
}else if(program.dirmode){
  var appsPath = projectPath
  var port = program.dirmode === true
    ? 9966
    : program.dirmode
  harp.server(appsPath, { port: port, hostMode: true }, function(){
    console.log("harp is hosting apps on port", port)
  })
}else if(program.compile){
  var outputPath = program.compile === true
    ? null
    : program.compile
  harp.compile(projectPath, outputPath, function(err, out){
    if(err){
      console.log(err)
    }else{
      console.log(JSON.stringify(out, null, 2))
    }
  })

}else{
  program.help()
}
