#!/usr/bin/env node

var path    = require('path')
var program = require('commander')
var pkg     = require('../package.json')
var harp    = require('../')

var init = function(program){
  var projectPath = path.resolve(program.project || process.cwd())
  console.log('init')
}

var server = function(program){
  var projectPath = path.resolve(program.project || process.cwd())      
  var port        = program.port || 9966
  harp.server(projectPath, { port: port }, function(){
    console.log("harp is listening on port", port)
  })
}

var compile = function(program){
  var projectPath = path.resolve(program.project || process.cwd())
  var outputPath  = program.output || null
  harp.compile(projectPath, outputPath, function(err, out){
    if(err){
      console.log(err)
    }else{
      console.log(JSON.stringify(out, null, 2))
    }
  })
}

program
  .version('0.0.1')
  .option('-p, --project <path>', 'path to harp project')
  .option('-o, --output <path>', 'specify output directory for compiled assets (compile)')
  .option('-P, --port <port>', 'specify port to listen on')
  .option('-D, --dirmode', 'change the working directory (server)')
program
  .command('init')
  .description('initalize new harp application in current directory')
  .action(init)
program
  .command('server')
  .description('start harp server')
  .action(server)
program
  .command('compile')
  .description('compile project to satic assets')
  .action(compile)

program.parse(process.argv)

if(program.args.length < 1){
  program.help()
}
